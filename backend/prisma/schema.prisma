generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model actions {
  id                 Int                 @id @default(autoincrement()) @db.UnsignedInt
  action_name        String              @db.VarChar(60)
  points             Int                 @db.UnsignedInt
  action_type        actions_action_type
  action_description String              @db.VarChar(100)
  arabic_action_name String              @db.VarChar(100)
  logs               logs[]
}

model departments {
  id               Int                @id @default(autoincrement()) @db.UnsignedInt
  name             String             @db.VarChar(50)
  type             departments_type
  departments_logs departments_logs[]
}

model departments_logs {
  id                Int         @id @default(autoincrement()) @db.UnsignedInt
  department_id     Int         @db.UnsignedInt
  log_id            Int         @db.UnsignedInt
  attendants_number Int?        @default(0) @db.UnsignedInt
  departments       departments @relation(fields: [department_id], references: [id], onDelete: Cascade, map: "departments_logs_ibfk_1")
  logs              logs        @relation(fields: [log_id], references: [id], onDelete: Cascade, map: "departments_logs_ibfk_2")

  @@unique([log_id, department_id], map: "departments_logs_unique")
  @@index([department_id], map: "departments_logs_departments_FK")
}

model logs {
  id               Int                @id @default(autoincrement()) @db.UnsignedInt
  action_id        Int                @db.UnsignedInt
  start_date       DateTime           @db.Date
  end_date         DateTime           @db.Date
  event_id         Int?               @db.UnsignedInt
  departments_logs departments_logs[]
  events           events?            @relation(fields: [event_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_events")
  actions          actions            @relation(fields: [action_id], references: [id], onDelete: Cascade, map: "logs_ibfk_1")
  members_logs     members_logs[]
  modifications    modifications[]

  @@index([action_id], map: "action_id")
  @@index([event_id], map: "fk_events")
}

model members {
  id           Int            @id @default(autoincrement()) @db.UnsignedInt
  name         String         @db.VarChar(50)
  email        String?        @db.VarChar(100)
  phone_number String?        @db.VarChar(20)
  uni_id       String         @unique(map: "uni_id") @db.VarChar(50)
  gender       members_gender
  members_logs members_logs[]
}

model members_logs {
  id        Int       @id @default(autoincrement()) @db.UnsignedInt
  member_id Int       @db.UnsignedInt
  log_id    Int       @db.UnsignedInt
  absence   absence[]
  members   members   @relation(fields: [member_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "members_logs_ibfk_1")
  logs      logs      @relation(fields: [log_id], references: [id], onDelete: Cascade, map: "members_logs_ibfk_2")

  @@unique([log_id, member_id], map: "members_logs_unique")
  @@index([member_id], map: "fk_members_id")
}

model modifications {
  id     Int                @id @default(autoincrement()) @db.UnsignedInt
  log_id Int                @db.UnsignedInt
  type   modifications_type
  value  Int                @db.UnsignedInt
  logs   logs               @relation(fields: [log_id], references: [id], onDelete: Cascade, map: "modifications_ibfk_1")

  @@index([log_id], map: "log_id")
}

model events {
  id   Int    @id @default(autoincrement()) @db.UnsignedInt
  name String @unique(map: "events_unique") @db.VarChar(150)
  logs logs[]

  @@index([name], map: "event_name")
}

model absence {
  id            Int           @id @default(autoincrement()) @db.UnsignedInt
  date          DateTime      @db.Date
  member_log_id Int?          @db.UnsignedInt
  members_logs  members_logs? @relation(fields: [member_log_id], references: [id], onDelete: Cascade, map: "absence_members_logs_FK")

  @@index([member_log_id], map: "absence_members_logs_FK")
}

view members_points {
  member_id     Int      @default(0) @db.UnsignedInt
  member_name   String   @db.VarChar(50)
  member_log_id Int      @default(0) @db.UnsignedInt
  log_id        Int      @default(0) @db.UnsignedInt
  event_name    String   @db.VarChar(150)
  start_date    DateTime @db.Date
  end_date      DateTime @db.Date
  action_points Int      @db.UnsignedInt
  action_name   String   @db.VarChar(60)
}

view departments_points {
  department_id     Int      @default(0) @db.UnsignedInt
  department_name   String   @db.VarChar(50)
  department_log_id Int      @default(0) @db.UnsignedInt
  log_id            Int      @default(0) @db.UnsignedInt
  start_date        DateTime @db.Date
  end_date          DateTime @db.Date
  event_name        String   @db.VarChar(150)
  action_points     Int      @db.UnsignedInt
  action_name       String   @db.VarChar(60)
}

enum modifications_type {
  bonus
  discount
}

enum actions_action_type {
  composite
  department
  member
}

enum members_gender {
  Male
  Female
}

enum departments_type {
  administrative
  practical
}
